---
sidebar_position: 9
---

import ViewSource from "@site/src/components/ViewSource";
import Answer from "@site/src/components/Answer";

# 誤差

## 浮動小数点数

コンピューターでは、浮動小数点方式が使われます。浮動小数点方式では、仮数部と指数部によって数値を表現します。

$12345 = \underbrace{1.2345}_{\text{仮数部}}\times 10^{\overbrace{-4}^{\text{指数部}}}$

物理的制約があるので、仮数部と指数部は有限桁でしか扱えません。

## 丸め誤差

世の中には、有限桁の小数では表せない数字は多くあります。

まずは、10 進数で考えましょう。
例えば、$\frac{1}{3}$ は有限桁の小数では表せません。$0.3$ も $0.33$ も $0.333$ も $\frac{1}{3}$ の近似でしかありません。
たとえ、 $0.3333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333333$ のようにしても同じことです。

2 進数においても同じことが起こります。
10 進数の $0.1$ を 2 進数で表すことを考えます。

$$
\begin{align*}
    0.1_{(10)} &= 0.0625_{(10)} + 0.03125_{(10)} + 0.00390625_{(10)} + 0.00195332_{(10)} + \cdots \\
               &= \frac{1}{16}_{(10)} + \frac{1}{32}_{(10)} + \frac{1}{256}_{(10)} + \frac{1}{512}_{(10)} + \cdots \\
               &= 0.0001_{(2)} + 0.00001_{(2)} + 0.0000001_{(2)} + 0.00000001_{(2)} + \cdots \\
               &= 0.000110011\cdots_{(2)}
\end{align*}
$$

このように $0.1_{(10)}$ は 2 進数では有限桁で表せません。

コンピューターは、有限桁しか表現できないことから、有効桁以降を切り捨てます。これによって、誤差が出るのが丸め誤差です。

## 桁落ち

有効数字を 7 桁で $\sqrt{1001}-\sqrt{999}$ を計算することを考えます。

$$
\sqrt{1001} = 31.638584\dots \simeq 31.63858
$$

$$
\sqrt{909} = 31.606961\dots \simeq 31.60696
$$

よって、

$$
\sqrt{1001}-\sqrt{999} \simeq 0.03162
$$

このようにすると、有効数字が 4 桁になってしまいます。

このように値がほぼ同じ数値同士で減算をしたときに有効桁数が減少することによって生まれる誤差が桁落ちです。

今回の場合は、回避策があります。

$$
\begin{align*}
    \sqrt{1001}-\sqrt{999} &= \frac{(\sqrt{1001}-\sqrt{999})(\sqrt{1001}+\sqrt{999})}{\sqrt{1001}+\sqrt{999}} \\
                           &= \frac{1001-999}{\sqrt{1001}+\sqrt{999}} \\
                           &= \frac{2}{\sqrt{1001}+\sqrt{999}} \\
                           &\simeq \frac{2}{31.63858+31.60696} \\
                           &= \frac{2}{63.24554} \\
                           &\simeq 0.03162278
\end{align*}
$$

これで、桁落ちを回避できます。

## 情報落ち

次の場合、有効数字が 5 桁なら

$$
\begin{align*}
    1.0000\times 10^4 + 1.0000 &= 1.0001 \times 10^4 \\
                               &\simeq 1.0001 \times 10^4
\end{align*}
$$

となって正しく計算できますが、有効数字が 4 桁だと、

$$
\begin{align*}
    1.000\times 10^4 + 1.000 &= 1.0001 \times 10^4 \\
                             &\simeq 1.000 \times 10^4
\end{align*}
$$

となって正しく計算できません。

次のように、何度も足す場合には計算結果が変わってきてしまいます。

$$
\begin{align*}
    1.000\times 10^4 + 4.000 + 4.000 + 4.000 &= 1.0004 \times 10^4 + 4.000 + 4.000 \\
                                             &\simeq 1.000 \times 10^4 + 4.000 + 4.000 \\
                                             &\simeq \cdots \\
                                             &\simeq 1.000 \times 10^4
\end{align*}
$$

このように、絶対値の大きい数と絶対値の小さい数を加減算したときに、絶対値の小さな数字が無視されてしまうことを情報落ちといいます。

<!-- ## 打ち切り誤差 -->
